<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DIF Public Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-white min-h-screen">

  <!-- Header -->
  <header class="border-b border-gray-200">
    <div class="max-w-5xl mx-auto px-6 py-6">
      <div class="flex items-center justify-between">
        <a href="index.html" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
          <div class="w-10 h-10 bg-black rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-bold text-black">DIF</h1>
            <p class="text-sm text-gray-600">Digital Identity Firewall</p>
          </div>
        </a>
        <a href="search.html" class="text-sm text-gray-600 hover:text-black transition-colors flex items-center gap-1">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
          </svg>
          Back to Search
        </a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-6 py-12">
    
    <!-- Verification Badge -->
    <div class="mb-8">
      <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 rounded-xl p-6 text-center">
        <div class="flex items-center justify-center gap-3 mb-2">
          <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          </div>
          <h2 class="text-xl font-bold text-green-900">Verified Human Account</h2>
        </div>
        <p class="text-sm text-green-700">This identity has been verified by the Digital Identity Firewall</p>
      </div>
    </div>

    <!-- Profile Card -->
    <div class="bg-white border-2 border-gray-200 rounded-xl p-8 shadow-sm mb-6">
      
      <div class="space-y-6">
        
        <!-- Header with Avatar -->
        <div class="flex items-start gap-6 pb-6 border-b border-gray-200">
          <div class="w-24 h-24 bg-black rounded-2xl flex items-center justify-center flex-shrink-0">
            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <h3 id="fullName" class="text-3xl font-bold text-black mb-2">Loading...</h3>
            <p id="username" class="text-xl text-gray-600 mb-3">@username</p>
            <div class="flex items-center gap-2">
              <div class="w-2 h-2 bg-green-500 rounded-full"></div>
              <span class="text-sm font-medium text-green-700">Verified Identity</span>
            </div>
          </div>
        </div>

        <!-- Public Fingerprint -->
        <div>
          <div class="flex items-center gap-2 mb-3">
            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            <h4 class="text-sm font-semibold text-black uppercase tracking-wide">Public Fingerprint</h4>
          </div>
          <div class="bg-gray-50 rounded-lg p-5 border border-gray-200">
            <p id="publicFP" class="font-mono text-sm text-black break-all leading-relaxed">Loading fingerprint...</p>
          </div>
        </div>

        <!-- Verified Accounts Section -->
        <div class="pt-6 border-t border-gray-200">
          <div class="flex items-center gap-2 mb-4">
            <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
            </svg>
            <h4 class="text-lg font-semibold text-black">Verified Accounts</h4>
          </div>
          
          <div id="verifiedList" class="space-y-3">
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200 text-center">
              <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-black mx-auto mb-2"></div>
              <p class="text-sm text-gray-600">Loading verified accounts...</p>
            </div>
          </div>
        </div>

      </div>

    </div>

    <!-- Trust Notice -->
    <div class="p-4 bg-green-50 rounded-lg border border-green-200">
      <div class="flex items-start gap-3">
        <div class="w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center flex-shrink-0">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
        </div>
        <div>
          <p class="text-sm font-semibold text-green-900 mb-1">Verified Identity</p>
          <p class="text-xs text-green-700">This profile represents a verified human account. All linked social accounts have been cryptographically verified through DIF's secure verification process.</p>
        </div>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-200 mt-16">
    <div class="max-w-5xl mx-auto px-6 py-6">
      <p class="text-sm text-gray-500 text-center">Secure identity management powered by DIF</p>
    </div>
  </footer>
  <!-- Floating Bottom Navigation Bar (Linux-inspired) -->
  <nav class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50">
    <div class="bg-black/95 backdrop-blur-xl border border-gray-800 rounded-xl shadow-2xl px-1 py-1">
      <div class="flex items-center gap-0.5">
        
        <!-- Home -->
        <a href="index.html" class="group relative flex items-center justify-center w-14 h-12 rounded-lg hover:bg-white/10 transition-all duration-200 active:scale-95">
          <div class="relative">
            <svg class="w-5 h-5 text-white transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
            </svg>
          </div>
          <!-- Active indicator -->
          <div class="absolute bottom-1 w-4 h-0.5 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
        </a>

        <!-- Divider -->
        <div class="w-px h-8 bg-gray-700"></div>

        <!-- Security -->
        <a href="security.html" class="group relative flex items-center justify-center w-14 h-12 rounded-lg hover:bg-white/10 transition-all duration-200 active:scale-95">
          <div class="relative">
            <svg class="w-5 h-5 text-white transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
            </svg>
            <!-- Notification badge -->
            <div class="absolute -top-0.5 -right-0.5 w-1.5 h-1.5 bg-green-500 rounded-full border border-black"></div>
          </div>
          <div class="absolute bottom-1 w-4 h-0.5 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
        </a>

        <!-- Divider -->
        <div class="w-px h-8 bg-gray-700"></div>

        <!-- Settings -->
        <a href="settings.html" class="group relative flex items-center justify-center w-14 h-12 rounded-lg hover:bg-white/10 transition-all duration-200 active:scale-95">
          <div class="relative">
            <svg class="w-5 h-5 text-white transition-transform group-hover:scale-110 group-hover:rotate-45 duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
          </div>
          <div class="absolute bottom-1 w-4 h-0.5 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
        </a>

      </div>
    </div>
  </nav>

<script type="module">
  import { db } from "./firebase-config.js";
  import { ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const params = new URLSearchParams(window.location.search);
  const username = params.get("user");

  document.getElementById("username").innerText = "@" + username;

  // ---------------------------
  // Load local AES key
  // ---------------------------
  function getEncKey() {
    const raw = localStorage.getItem("dif_enc_key");
    if (!raw) return null; // viewer is not owner
    return Uint8Array.from(raw.split(",").map(Number));
  }

  // ---------------------------
  // AES-GCM Decrypt Function
  // ---------------------------
  async function decryptAES(cipher, iv, keyBytes) {
    const cryptoKey = await crypto.subtle.importKey(
      "raw",
      keyBytes,
      "AES-GCM",
      false,
      ["decrypt"]
    );

    const decrypted = await crypto.subtle.decrypt(
      { name: "AES-GCM", iv: new Uint8Array(iv) },
      cryptoKey,
      new Uint8Array(cipher)
    );

    return new TextDecoder().decode(decrypted);
  }

  // ---------------------------
  // Load profile
  // ---------------------------
  async function loadProfile() {

    // 1) Full name
    const nameSnap = await get(ref(db, "user_public/" + username + "/fullName"));
    document.getElementById("fullName").innerText =
      nameSnap.exists() ? nameSnap.val() : "Unknown User";

    // 2) Public Fingerprint (correct: retrieve from dif_by_fp)
    const fpRootSnap = await get(ref(db, "dif_by_fp"));

    let foundFP = null;

    if (fpRootSnap.exists()) {
      const allFPs = fpRootSnap.val();
      
      for (const fp in allFPs) {
        if (allFPs[fp].username === username) {
          foundFP = fp;
          break;
        }
      }
    }

    document.getElementById("publicFP").innerText =
      foundFP ? foundFP : "Fingerprint not available";


    // 3) Verified socials
    const verifiedList = document.getElementById("verifiedList");
    const linkSnap = await get(ref(db, "user_links/" + username));

    if (!linkSnap.exists()) {
      verifiedList.innerHTML = `<p>No verified accounts</p>`;
      return;
    }

        const links = linkSnap.val();
    let hasVerified = false;
    verifiedList.innerHTML = "";

    // ====================================
    // INSTAGRAM — HASH-BASED VERIFICATION
    // ====================================
    if (links.instagram) {
      hasVerified = true;

      const igHash = links.instagram; // hash

      verifiedList.innerHTML += `
        <div class="group flex items-center justify-between bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-5 border hover:border-purple-400">

          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center">
              <!-- Instagram icon -->
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2zm0 1.5A4.25 4.25 0 0 0 3.5 7.75v8.5A4.25 4.25 0 0 0 7.75 20.5h8.5a4.25 4.25 0 0 0 4.25-4.25v-8.5A4.25 4.25 0 0 0 16.25 3.5h-8.5zm8.75 2a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5zM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 1.5A3.5 3.5 0 1 0 12 15a3.5 3.5 0 0 0 0-7z"/>
              </svg>
            </div>

            <div>
              <p class="text-xs font-semibold text-purple-700 uppercase tracking-wide">Instagram</p>
              <p class="text-base font-semibold text-purple-900">Verified ✓</p>
            </div>
          </div>

          <span class="text-[10px] opacity-60">${igHash.slice(0, 10)}…</span>

        </div>
      `;
    }

    // ====================================
    // TELEGRAM — HASH-BASED VERIFICATION
    // ====================================
    if (links.telegram) {
      hasVerified = true;

      const tgHash = links.telegram;

      verifiedList.innerHTML += `
        <div class="group flex items-center justify-between bg-gradient-to-r from-sky-50 to-blue-50 rounded-lg p-5 border hover:border-sky-400">

          <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-sky-500 rounded-lg flex items-center justify-center">
              <!-- Telegram icon -->
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0ZM17.5452 8.28747L15.8578 16.2213C15.7328 16.7918 15.3954 16.93 14.9091 16.654L12.3598 14.7725L11.1278 15.9613C10.9903 16.0988 10.8746 16.2145 10.6122 16.2145L10.7935 13.6213L15.5529 9.32305C15.7591 9.13989 15.5061 9.03552 15.2284 9.21868L9.45673 12.8524L6.94566 12.0676C6.39955 11.8968 6.38891 11.536 7.05924 11.2599L16.8774 7.32669C17.3368 7.14662 17.742 7.42196 17.5452 8.28747Z" />
              </svg>
            </div>

            <div>
              <p class="text-xs font-semibold text-sky-700 uppercase tracking-wide">Telegram</p>
              <p class="text-base font-semibold text-sky-900">Verified ✓</p>
            </div>
          </div>

          <span class="text-[10px] opacity-60">${tgHash.slice(0, 10)}…</span>

        </div>
      `;
    }

    // If nothing verified
    if (!hasVerified) {
      verifiedList.innerHTML = `
        <div class="bg-gray-50 rounded-lg p-6 border border-gray-200 text-center">
          <p class="text-sm text-gray-600">No verified accounts</p>
        </div>
      `;
    }


    

    } // <-- CLOSE loadProfile() properly

    // Call the function
    loadProfile();


</script>



</body>
</html>
